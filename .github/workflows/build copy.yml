name: "Build"
on:
    push:
        branches:
            - "1.x"
        tags:
            - v1*
        paths-ignore:
            - "docs/**"
            - "assets/**"
            - "**.md"
    pull_request:
        branches:
            - "1.x"
        types: [opened, reopened, synchronize]
        paths-ignore:
            - "docs/**"
            - "assets/**"
            - "**.md"
jobs:
    lint:
        runs-on: ubuntu-latest
        env:
            TEST: "build_and_lint"
            GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        steps:
            - uses: actions/setup-node@v1
              with:
                  node-version: 12
            - uses: actions/checkout@v2

            - uses: actions/cache@v2
              id: cache-deps
              with:
                  path: |
                      node_modules
                      */*/node_modules
                  key: ${{ runner.os }}-node14-${{ hashFiles('**/package-lock.json') }}

            - run: npm ci
              if: steps.cache-deps.outputs.cache-hit != 'true'

            - run: bash ./scripts/ci.sh
    unit:
        runs-on: ubuntu-latest
        strategy:
            matrix:
                node: [14, 16, 18]
        env:
            TEST: "unit"
        steps:
            - uses: actions/setup-node@v1
              with:
                  node-version: ${{ matrix.node }}

            - uses: actions/checkout@v2

            - uses: actions/cache@v2
              id: cache-deps
              with:
                  path: |
                      node_modules
                      */*/node_modules
                  key: ${{ runner.os }}-node${{ matrix.node }}-${{ hashFiles('**/package-lock.json') }}

            - run: npm ci
              if: steps.cache-deps.outputs.cache-hit != 'true'

            - run: bash ./scripts/ci.sh
